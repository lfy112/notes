# 笔记

## 网址到网页显示，期间发生了什么？

1. 解析URL，生成HTTP请求：http://www.xxx.com/dir/filename

   没有路径及文件名是访问默认的文件index.html

2. 解析IP地址：DNS协议（UDP，53端口）

   查询浏览器缓存->查询本地host文件->查询首选的DNS服务器->查询根DNS服务器->查询二级、三级服务器

   * 根 DNS 服务器（.）
   * 顶级域 DNS 服务器（.com）
   * 权威 DNS 服务器（server.com）

3. 协议栈

   协议栈的内部分为几个部分，分别承担不同的工作。上下关系是有一定的规则的，上面的部分会向下面的部分委托工作，下面的部分收到委托的工作并执行。

4. 可靠传输：TCP

   三次握手建立连接，四次挥手断开连接

## 缓存

分为强制缓存和协商缓存

强制缓存：由浏览器确定是否使用缓存。服务器返回的报文包含Cache-Control字段，是相对时间，表示过期时间。客户端再发送请求前进行对比，选择是否使用缓存

协商缓存：304状态码，表示可以继续使用缓存，没有进行过更新。方法1：使用请求头部中的 `If-Modified-Since` 字段与响应头部中的 `Last-Modified` 字段实现。方法2：使用请求头部中的 `If-None-Match` 字段与响应头部中的 `ETag` 字段。

![img](./imgs/http缓存.webp)

## HTTP的不安全

窃听：混合加密

篡改：对数据进行校验

冒充：证书机制

## HTTP 1.1 优化

避免发送请求：缓存

减少HTTP请求次数：1. 减少重定向请求次数：代理服务器负责重定向。2. 合并请求：将资源进行合并。3. 延迟发送请求：每次只请求用户能看到的部分

减少数据大小：压缩

## websocket

某些场景下，用户并未操作，但需要更新数据。可选的解决方法有：1. 不断轮询：客户端不断向后端发送请求，更新数据。2. 长轮询：将超时时间增加，可以在一次请求里面延迟发送数据。

```
Connection: Upgrade
Upgrade: WebSocket
Sec-WebSocket-Key: T2a6wZlAwhgQNqruZ2YUyg==\r\n
```

